@using Debts.ViewModels
@model TaskViewModel

@using (Html.BeginForm("AddOrEditTask", "Tasks", FormMethod.Post, new { @class = "form", role = "form"}))
{
    @Html.HiddenFor(m => m.TaskId)
    @Html.HiddenFor(m => m.UserId)

    @Html.LabelFor(m => m.Name, new { @class = "" })
    @Html.TextBoxFor(m => m.Name)
    @Html.ValidationMessageFor(m => m.Name)

    @Html.LabelFor(m => m.Sum, new { @class = "" })
    @Html.TextBoxFor(m => m.Sum, new { onkeyup="changeSum()"})
    @Html.ValidationMessageFor(m => m.Sum)


    <div id="divMembers">
        <label>Members</label>
        @foreach (var key in Model.Members.Keys)
        {
            @Html.Partial("AddMember", new EditTaskMemberViewModel(Model.Members, key))
        }
    </div>

    <button type="button" onclick="AddMemberButton()" class="btn btn-danger">Add Member</button>



    <input type="submit" class="frm-btn btn btn-danger" value="Save" />

}

<div id="divNewMemberTemplate" class="hide" hidden="hidden">
    @Html.Partial("AddMember", new EditTaskMemberViewModel(null, int.MaxValue.ToString()))
</div>

<script type="text/javascript">

    var slotsCount = @(Model.Members.Count);

    function AddMemberButton() {
        var template = $('#divNewMemberTemplate');
        var timeSlotIndex = slotsCount;
        var newTimeSlot = $(template.html().replace(new RegExp('@int.MaxValue', 'g'), timeSlotIndex));
        $('#divMembers').append(newTimeSlot);
        slotsCount++;
        changeSum();
    }

    function removeMember(btn) {
        console.log("remove");
        $(btn).closest('[data-member-row]').remove();
        changeSum();
    }

    function changeSum() {
        var sumInput = document.getElementById("Sum").value;
        console.log(sumInput);

        var depositInputs = document.getElementsByClassName("deposit");
        for (var iterator = 0; iterator < depositInputs.length - 1; iterator++) {
            depositInputs[iterator].value = (sumInput / (depositInputs.length - 1)).toFixed(2);
        }

    }

    function changeDebt() {
        console.log("change debt trigger");
        var debtsInputs = document.getElementsByClassName("debt");
        for (var iterator = 0; iterator < debtsInputs.length-1; iterator++) {
            console.log(debtsInputs[iterator].value);
        }
        //console.log(debtsInputs);
    }

    function changeDeposit() {
        console.log("change deposit trigger");
        var depositInputs = document.getElementsByClassName("deposit");
        for (var iterator = 0; iterator < depositInputs.length-1; iterator++) {
            console.log(depositInputs[iterator].value);
        }
        //console.log(debtsInputs);
    }

</script>
